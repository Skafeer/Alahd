<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تذكير دعاء العهد - تحديد الموقع الجغرافي الدقيق</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1a5d38;
            --primary-dark: #0d4728;
            --secondary: #2d8aaf;
            --light: #f8f9fa;
            --dark: #1e2a35;
            --gold: #d4af37;
            --silver: #c0c0c0;
            --danger: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
            --transition: all 0.4s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #0c1e25 0%, #0a1620 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            line-height: 1.7;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(25, 40, 55, 0.85);
            backdrop-filter: blur(12px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .date-banner {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            text-align: center;
            padding: 10px 0;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--gold);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, var(--gold), var(--silver));
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: white;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        @media (min-width: 768px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.07);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.09);
        }

        .card-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .card-title i {
            font-size: 1.8rem;
            color: var(--secondary);
        }

        .info-group {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.1rem;
        }

        .info-value {
            font-weight: 700;
            color: var(--gold);
            font-size: 1.1rem;
            text-align: left;
            min-width: 100px;
        }

        .accuracy-meter {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .meter-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #aaa;
        }

        .meter-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(to right, var(--danger), var(--warning), var(--success));
            width: 0%;
            transition: width 1s ease;
        }

        .meter-indicator {
            position: absolute;
            top: 0;
            width: 4px;
            height: 100%;
            background: white;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .accuracy-value {
            text-align: center;
            font-weight: bold;
            margin-top: 5px;
            color: var(--success);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: var(--secondary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
        }

        .btn-primary:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
        }

        .btn-gold {
            background: linear-gradient(to right, #d4af37, #b8860b);
        }

        .btn-gold:hover {
            background: linear-gradient(to right, #b8860b, #d4af37);
        }

        .btn-danger {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }

        .btn-danger:hover {
            background: linear-gradient(to right, #c0392b, #e74c3c);
        }

        .location-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .location-info {
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .location-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-indicator {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .status-active {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
        }

        .status-inactive {
            background: var(--danger);
        }

        .status-warning {
            background: var(--warning);
        }

        .methods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .method-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .method-icon {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .method-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .method-accuracy {
            font-size: 0.9rem;
            color: #aaa;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .instructions h3 {
            color: var(--gold);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions ul {
            padding-right: 20px;
            margin-bottom: 15px;
        }

        .instructions li {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .instructions li i {
            color: var(--secondary);
            margin-top: 5px;
        }

        footer {
            text-align: center;
            padding: 25px;
            font-size: 1rem;
            opacity: 0.8;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        /* تصميم متجاوب */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }
            
            .info-item {
                flex-direction: column;
                gap: 5px;
            }
            
            .info-value {
                text-align: right;
            }
            
            .methods-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 20px;
            }
            
            .card {
                padding: 20px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }

        .prayer-animation {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            opacity: 0.3;
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .permission-dialog {
            background: rgba(30, 40, 50, 0.95);
            border-radius: var(--radius);
            padding: 25px;
            text-align: center;
            border: 2px solid var(--gold);
            max-width: 500px;
            margin: 20px auto;
            display: none;
        }
        
        .permission-dialog h3 {
            color: var(--gold);
            margin-bottom: 15px;
        }
        
        .dialog-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="date-banner">
            <i class="fas fa-calendar-alt"></i> اليوم: السبت 12 يوليو 2025 الموافق 17 محرم 1447 هـ
        </div>
        
        <header>
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23d4af37' d='M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A1,1 0 0,0 11,7A1,1 0 0,0 12,8A1,1 0 0,0 13,7A1,1 0 0,0 12,6M6.94,7.82L5.76,8.99L7.17,10.4L8.35,9.22L6.94,7.82M17.06,7.82L15.65,9.22L16.83,10.4L18.24,9.01L17.06,7.82M12,10C9.24,10 7,12.24 7,15A3,3 0 0,0 10,18C10.64,18 11.23,17.77 11.71,17.41C11.4,16.86 11.2,16.24 11.2,15.58C11.2,14.25 12.17,13.15 13.45,13C13.78,12.41 14.33,12 15,12C15.67,12 16.22,12.41 16.55,13C17.83,13.15 18.8,14.25 18.8,15.58C18.8,16.24 18.6,16.86 18.29,17.41C18.77,17.77 19.36,18 20,18A3,3 0 0,0 23,15C23,12.24 20.76,10 18,10H12Z'/%3E%3C/svg%3E" 
                 alt="Prayer" class="prayer-animation">
            <h1><i class="fas fa-location-dot"></i> تحديد الموقع الجغرافي الدقيق</h1>
            <p>تحديد دقيق لموقعك الجغرافي لضمان دقة أوقات الصلاة</p>
        </header>
        
        <div class="main-content">
            <div class="card">
                <h2 class="card-title"><i class="fas fa-map-location-dot"></i> معلومات موقعك</h2>
                
                <div class="location-status">
                    <div>
                        <span class="status-indicator status-warning" id="status-indicator"></span>
                        <span>حالة الموقع:</span>
                    </div>
                    <span id="location-status">جارٍ التحديد...</span>
                </div>
                
                <div class="info-group">
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-latitude"></i> خط العرض:</span>
                        <span class="info-value" id="latitude">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-longitude"></i> خط الطول:</span>
                        <span class="info-value" id="longitude">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label"><i class="fas fa-map-marker-alt"></i> الموقع التقريبي:</span>
                        <span class="info-value" id="location-name">--</span>
                    </div>
                </div>
                
                <h2 class="card-title"><i class="fas fa-bullseye"></i> دقة تحديد الموقع</h2>
                
                <div class="accuracy-meter">
                    <div class="meter-labels">
                        <span>منخفضة</span>
                        <span>متوسطة</span>
                        <span>عالية</span>
                    </div>
                    <div class="meter-bar">
                        <div class="meter-fill" id="meter-fill"></div>
                        <div class="meter-indicator" id="meter-indicator"></div>
                    </div>
                    <div class="accuracy-value" id="accuracy-value">--</div>
                </div>
                
                <div class="methods-grid">
                    <div class="method-card">
                        <div class="method-icon"><i class="fas fa-satellite"></i></div>
                        <div class="method-name">GPS</div>
                        <div class="method-accuracy">5-20 متر</div>
                    </div>
                    <div class="method-card">
                        <div class="method-icon"><i class="fas fa-wifi"></i></div>
                        <div class="method-name">Wi-Fi</div>
                        <div class="method-accuracy">20-100 متر</div>
                    </div>
                    <div class="method-card">
                        <div class="method-icon"><i class="fas fa-tower-cell"></i></div>
                        <div class="method-name">برج الجوال</div>
                        <div class="method-accuracy">300-1000 متر</div>
                    </div>
                    <div class="method-card">
                        <div class="method-icon"><i class="fas fa-globe"></i></div>
                        <div class="method-name">عنوان IP</div>
                        <div class="method-accuracy">10-100 كم</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="get-location-btn">
                    <i class="fas fa-location-crosshairs"></i> تحديث الموقع
                </button>
                
                <button class="btn" id="manual-location-btn">
                    <i class="fas fa-map-pin"></i> تحديد الموقع يدوياً
                </button>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-gears"></i> إعدادات الدقة</h2>
                
                <div class="location-section">
                    <div class="location-info">
                        <p><i class="fas fa-lightbulb"></i> لتحسين دقة الموقع، يرجى تفعيل الخيارات التالية:</p>
                    </div>
                    
                    <div class="settings-group">
                        <div class="info-item">
                            <span class="info-label"><i class="fas fa-map-pin"></i> تحديد دقيق:</span>
                            <label class="switch">
                                <input type="checkbox" id="high-accuracy" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label"><i class="fas fa-clock"></i> مهلة الانتظار:</span>
                            <select id="timeout-select" style="padding: 8px; border-radius: 8px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.1);">
                                <option value="5000">5 ثواني</option>
                                <option value="10000" selected>10 ثواني</option>
                                <option value="15000">15 ثواني</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-circle-info"></i> نصائح لتحسين الدقة</h3>
                    <ul>
                        <li><i class="fas fa-check-circle"></i> تفعيل خدمات الموقع (GPS/Wi-Fi) على جهازك</li>
                        <li><i class="fas fa-check-circle"></i> الخروج إلى مكان مفتوح لتحسين إشارة GPS</li>
                        <li><i class="fas fa-check-circle"></i> التأكد من اتصال Wi-Fi في الأماكن المغلقة</li>
                        <li><i class="fas fa-check-circle"></i> تحديث المتصفح إلى أحدث نسخة</li>
                        <li><i class="fas fa-check-circle"></i> استخدام HTTPS لتحسين الدقة والأمان</li>
                    </ul>
                </div>
                
                <button class="btn btn-gold" id="location-help-btn">
                    <i class="fas fa-question-circle"></i> مساعدة في مشاكل الموقع
                </button>
            </div>
        </div>
        
        <div class="permission-dialog" id="permission-dialog">
            <h3><i class="fas fa-location-dot"></i> إذن الوصول إلى الموقع</h3>
            <p>يحتاج التطبيق إلى إذنك للوصول إلى موقعك الجغرافي لتحديد أوقات الصلاة بدقة.</p>
            <p>الرجاء منح الإذن لاستخدام كامل مزايا التطبيق.</p>
            <div class="dialog-buttons">
                <button class="btn btn-gold" id="allow-permission">
                    <i class="fas fa-check"></i> السماح
                </button>
                <button class="btn btn-danger" id="deny-permission">
                    <i class="fas fa-times"></i> رفض
                </button>
            </div>
        </div>
        
        <footer>
            <p><i class="fas fa-code"></i> تطبيق تذكير دعاء العهد | نظام تحديد الموقع الجغرافي الدقيق</p>
            <p>تم التطوير باستخدام تقنيات HTML5 Geolocation API</p>
        </footer>
    </div>

    <script>
        // عناصر DOM
        const latitudeElement = document.getElementById('latitude');
        const longitudeElement = document.getElementById('longitude');
        const locationNameElement = document.getElementById('location-name');
        const locationStatusElement = document.getElementById('location-status');
        const statusIndicator = document.getElementById('status-indicator');
        const accuracyValueElement = document.getElementById('accuracy-value');
        const meterFill = document.getElementById('meter-fill');
        const meterIndicator = document.getElementById('meter-indicator');
        const getLocationBtn = document.getElementById('get-location-btn');
        const highAccuracyToggle = document.getElementById('high-accuracy');
        const timeoutSelect = document.getElementById('timeout-select');
        const permissionDialog = document.getElementById('permission-dialog');
        const allowPermissionBtn = document.getElementById('allow-permission');
        const denyPermissionBtn = document.getElementById('deny-permission');

        // إظهار طلب الإذن عند التحميل
        window.addEventListener('load', () => {
            // إظهار طلب الإذن فقط إذا لم يكن مسموحاً مسبقاً
            if (navigator.permissions) {
                navigator.permissions.query({name: 'geolocation'}).then(permissionStatus => {
                    if (permissionStatus.state === 'prompt') {
                        setTimeout(() => {
                            permissionDialog.style.display = 'block';
                        }, 1000);
                    }
                });
            } else {
                // المتصفحات التي لا تدعم navigator.permissions
                setTimeout(() => {
                    permissionDialog.style.display = 'block';
                }, 1000);
            }
        });

        // معالجة اختيارات الإذن
        allowPermissionBtn.addEventListener('click', () => {
            permissionDialog.style.display = 'none';
            getLocation();
        });

        denyPermissionBtn.addEventListener('click', () => {
            permissionDialog.style.display = 'none';
            updateLocationStatus('تم رفض إذن الموقع', 'status-inactive');
        });

        // دالة تحديد الموقع الجغرافي
        function getLocation() {
            updateLocationStatus('جارٍ تحديد موقعك...', 'status-warning');
            
            const highAccuracy = highAccuracyToggle.checked;
            const timeout = parseInt(timeoutSelect.value);
            
            const options = {
                enableHighAccuracy: highAccuracy,
                timeout: timeout,
                maximumAge: 0
            };
            
            if (!navigator.geolocation) {
                updateLocationStatus('المتصفح لا يدعم خدمة الموقع', 'status-inactive');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                successCallback,
                errorCallback,
                options
            );
        }

        // معالجة نجاح تحديد الموقع
        function successCallback(position) {
            const { latitude, longitude, accuracy } = position.coords;
            
            // تحديث واجهة المستخدم
            latitudeElement.textContent = latitude.toFixed(6);
            longitudeElement.textContent = longitude.toFixed(6);
            accuracyValueElement.textContent = `${Math.round(accuracy)} متر`;
            
            // تحديث شريط الدقة
            updateAccuracyMeter(accuracy);
            
            // الحصول على اسم الموقع
            getLocationName(latitude, longitude);
            
            // تحديث الحالة
            updateLocationStatus('تم تحديد الموقع بنجاح', 'status-active');
            
            // تخزين الموقع في localStorage
            localStorage.setItem('userLocation', JSON.stringify({
                lat: latitude,
                lng: longitude,
                accuracy: accuracy,
                timestamp: new Date().getTime()
            }));
        }

        // تحديث شريط الدقة
        function updateAccuracyMeter(accuracy) {
            // حساب النسبة المئوية للدقة (كلما قل الرقم زادت الدقة)
            let accuracyPercentage;
            if (accuracy < 20) {
                accuracyPercentage = 95 + (20 - accuracy); // 95-100%
            } else if (accuracy < 50) {
                accuracyPercentage = 80 + (50 - accuracy) / 30 * 15; // 80-95%
            } else if (accuracy < 100) {
                accuracyPercentage = 60 + (100 - accuracy) / 50 * 20; // 60-80%
            } else if (accuracy < 500) {
                accuracyPercentage = 30 + (500 - accuracy) / 400 * 30; // 30-60%
            } else {
                accuracyPercentage = accuracy > 1000 ? 5 : 30 * (1000 / accuracy);
            }
            
            accuracyPercentage = Math.min(100, Math.max(5, accuracyPercentage));
            
            // تحديث شريط الدقة
            meterFill.style.width = `${accuracyPercentage}%`;
            meterIndicator.style.left = `${accuracyPercentage}%`;
            
            // تلوين المؤشر حسب الدقة
            if (accuracy < 20) {
                meterFill.style.background = 'linear-gradient(to right, var(--danger), var(--warning), var(--success))';
            } else if (accuracy < 100) {
                meterFill.style.background = 'linear-gradient(to right, var(--danger), var(--warning))';
            } else {
                meterFill.style.background = 'var(--danger)';
            }
        }

        // معالجة أخطاء تحديد الموقع
        function errorCallback(error) {
            let errorMessage;
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "تم رفض إذن الموقع. الرجاء تفعيل الإذن في إعدادات المتصفح.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "معلومات الموقع غير متوفرة.";
                    break;
                case error.TIMEOUT:
                    errorMessage = "انتهى الوقت المخصص لتحديد الموقع. الرجاء المحاولة مرة أخرى.";
                    break;
                default:
                    errorMessage = "حدث خطأ غير متوقع أثناء تحديد الموقع.";
            }
            
            updateLocationStatus(errorMessage, 'status-inactive');
            
            // محاولة استخدام آخر موقع مخزن
            const savedLocation = localStorage.getItem('userLocation');
            if (savedLocation) {
                const location = JSON.parse(savedLocation);
                latitudeElement.textContent = location.lat.toFixed(6);
                longitudeElement.textContent = location.lng.toFixed(6);
                accuracyValueElement.textContent = `${Math.round(location.accuracy)} متر (بيانات قديمة)`;
                updateAccuracyMeter(location.accuracy);
                getLocationName(location.lat, location.lng);
            }
        }

        // تحديث حالة الموقع
        function updateLocationStatus(message, statusClass) {
            locationStatusElement.textContent = message;
            statusIndicator.className = 'status-indicator ' + statusClass;
        }

        // الحصول على اسم الموقع باستخدام Geocoding API
        function getLocationName(latitude, longitude) {
            // في التطبيق الحقيقي، استخدم خدمة مثل OpenStreetMap Nominatim
            // هذا مثال محاكاة لأغراض العرض
            
            const locations = [
                { name: "مكة المكرمة, السعودية", lat: 21.4225, lng: 39.8262 },
                { name: "المدينة المنورة, السعودية", lat: 24.5247, lng: 39.5692 },
                { name: "الرياض, السعودية", lat: 24.7136, lng: 46.6753 },
                { name: "جدة, السعودية", lat: 21.5433, lng: 39.1728 }
            ];
            
            // البحث عن أقرب موقع
            let closestLocation = null;
            let minDistance = Infinity;
            
            locations.forEach(loc => {
                const distance = Math.sqrt(
                    Math.pow(loc.lat - latitude, 2) + Math.pow(loc.lng - longitude, 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestLocation = loc;
                }
            });
            
            if (closestLocation) {
                locationNameElement.textContent = closestLocation.name;
            } else {
                locationNameElement.textContent = "موقع غير معروف";
            }
        }

        // إعداد مستمعي الأحداث
        getLocationBtn.addEventListener('click', getLocation);
        
        highAccuracyToggle.addEventListener('change', () => {
            if (highAccuracyToggle.checked) {
                alert("تم تفعيل وضع الدقة العالية. سيستهلك المزيد من البطارية لكنه يعطي نتائج أدق.");
            }
        });
        
        // تحديد الموقع يدوياً
        document.getElementById('manual-location-btn').addEventListener('click', () => {
            const city = prompt("الرجاء إدخال مدينتك:");
            if (city) {
                locationNameElement.textContent = city + "، السعودية";
                alert(`تم تعيين موقعك إلى ${city}. سيتم استخدام أوقات الصلاة لهذه المنطقة.`);
            }
        });
        
        // مساعدة في مشاكل الموقع
        document.getElementById('location-help-btn').addEventListener('click', () => {
            alert("لحل مشاكل تحديد الموقع:\n\n1. تأكد من تفعيل خدمات الموقع على جهازك\n2. تأكد من منح الإذن للمتصفح للوصول إلى موقعك\n3. حاول الخروج إلى مكان مفتوح لتحسين إشارة GPS\n4. تأكد من اتصالك بالإنترنت");
        });

        // محاولة تحديد الموقع تلقائياً عند التحميل إذا كان مسموحاً
        if (navigator.geolocation) {
            navigator.permissions.query({name: 'geolocation'}).then(permissionStatus => {
                if (permissionStatus.state === 'granted') {
                    getLocation();
                }
            });
        }
    </script>
</body>
</html>
